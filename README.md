# ElasticPanoramaDepthRefine

# å•å›¾çƒé¢æ·±åº¦åœºçš„å„å‘å¼‚æ€§å¼¹æ€§çŸ«æ­£

**(Single-Panorama Anisotropic Elastic Depth Refinement)**

---

## 1ï¸âƒ£ åšä»€ä¹ˆï¼ˆWhatï¼‰

ç»™å®šä¸€å¼ å…¨æ™¯å›¾ï¼š

* åˆå§‹æ·±åº¦å›¾
  [
  D_0(\theta, \phi)
  \quad\text{ï¼ˆç”± DAP é¢„æµ‹ï¼‰}
  ]
* ç¨€ç–ä½†å‡†ç¡®çš„å‚è€ƒç‚¹äº‘
  [
  {(\theta_k, \phi_k, D^{\text{ref}}_k)}
  \quad\text{ï¼ˆæ¥è‡ª COLMAP / LiDAR æŠ•å½±ï¼‰}
  ]

**ç›®æ ‡ï¼š**

æž„å»ºä¸€ä¸ª**çƒé¢ä¸Šçš„æ·±åº¦ä½ç§»åœº**
[
\Delta(\theta, \phi)
]

ä½¿å¾—ï¼š

* åœ¨å‚è€ƒç‚¹å¤„ï¼Œæ·±åº¦è¢«ç²¾ç¡®å¯¹é½ï¼ˆåƒâ€œé’‰å­â€ï¼‰
* ä½ç§»é€šè¿‡â€œå¼¹æ€§ä¼ æ’­â€å½±å“é‚»åŸŸ
* **ä¼ æ’­æ²¿ç»“æž„å†…è¿›è¡Œï¼Œåœ¨è¾¹ç¼˜å¤„è‡ªåŠ¨ä¸­æ–­**
* sky / è¿œå¤„ / æ— é”šåŒºåŸŸä¸è¢«æ•´ä½“æ‹‰å˜å½¢

æœ€ç»ˆè¾“å‡ºçŸ«æ­£åŽçš„æ·±åº¦å›¾ï¼š

[
D(\theta, \phi)
===============

\exp\big(
\log D_0(\theta, \phi) + \Delta(\theta, \phi)
\big)
]

> âš ï¸ **æ³¨æ„**ï¼š
> æœ¬æ–¹æ³•åœ¨ **log-depth ç©ºé—´** ä¸­è¿›è¡Œä¼˜åŒ–ã€‚

---

## 2ï¸âƒ£ ä¸ºä»€ä¹ˆï¼ˆWhyï¼‰

### 2.1 å•å›¾ spline / grid æ–¹æ³•çš„é—®é¢˜

* 1D splineï¼šæ¯æ¡ ray ç‹¬ç«‹ï¼Œæ— æ³•ä¿æŒå¹³é¢ä¸Žç»“æž„ä¸€è‡´æ€§
* çƒé¢ B-spline gridï¼š

  * æœ¬è´¨æ˜¯ä½Žé¢‘è¿žç»­åœº
  * knot æœ‰å…¨å±€æ”¯æŒ
  * **ç»“æž„åŒºä¸Žå¤©ç©ºæ— æ³•è§£è€¦**

ç»“æžœæ˜¯ï¼š

> æ¥¼å®‡è¾¹ç¼˜è¢«æ‹‰æ­£ï¼Œä½†å¤©ç©ºä¸Žè¿œæ™¯ä¸€èµ·è¢«æ‹–åŠ¨ã€‚

---

### 2.2 æœ¬æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³

æˆ‘ä»¬å°†æ·±åº¦çŸ«æ­£é—®é¢˜ä»Žï¼š

> **â€œå‡½æ•°é‡å‚æ•°åŒ–â€**

è½¬ä¸ºï¼š

> **â€œåœ¨çƒé¢å›¾ä¸Šçš„ç‰©ç†å˜å½¢é—®é¢˜â€**

å…³é”®ç›´è§‰ï¼š

* ç¨€ç–å‚è€ƒç‚¹ = **åˆšæ€§é”šç‚¹ï¼ˆé’‰å­ï¼‰**
* æ·±åº¦åœº = **å¼¹æ€§è–„è†œ**
* DAP çš„æ·±åº¦æ¢¯åº¦ = **ææ–™çš„å„å‘å¼‚æ€§**
* ç»“æž„è¾¹ç¼˜ = **åŠ›çš„æ–­è£‚å¸¦**

---

## 3ï¸âƒ£ æ€Žä¹ˆåšï¼ˆHowï¼‰

---

## 3.1 ä¼˜åŒ–å˜é‡ä¸Žç©ºé—´å®šä¹‰

### æ‰€æœ‰æ·±åº¦ç›¸å…³é‡ **åœ¨ log ç©ºé—´**

å®šä¹‰ï¼š

[
z_0(i) = \log D_0(i)
]

[
\Delta(i) \in \mathbb{R}
\quad\text{ï¼ˆlog-depth displacementï¼‰}
]

æœ€ç»ˆæ·±åº¦ï¼š

[
z(i) = z_0(i) + \Delta(i)
]

---

## 3.2 çƒé¢å›¾è¡¨ç¤º

* æ¯ä¸ªåƒç´  ( i ) æ˜¯ä¸€ä¸ªèŠ‚ç‚¹
* é‚»æŽ¥è¾¹ ( (i,j) )ï¼šçƒé¢ 4-connected æˆ– 8-connected
* ç»åº¦æ–¹å‘å‘¨æœŸ wrap
* æžåŒºå¯é€‰ maskï¼ˆéžæœ¬æ–¹æ¡ˆæ ¸å¿ƒï¼‰

---

## 3.3 å„å‘å¼‚æ€§å¼¹æ€§æƒé‡ï¼ˆå…³é”®è®¾è®¡ï¼‰

### åœ¨ **log-depth ç©ºé—´** è®¡ç®—æ¢¯åº¦

[
\nabla z_0(i) = \nabla \log D_0(i)
]

å¯¹ç›¸é‚»åƒç´  ( i, j )ï¼Œå®šä¹‰æƒé‡ï¼š

[
w_{ij}
======

\exp!\left(

* \lambda_g
  |\nabla z_0(i) - \nabla z_0(j)|_2
  \right)
  \cdot
  \exp!\left(
* \lambda_e \cdot E(i,j)
  \right)
  ]

å…¶ä¸­ï¼š

* ( E(i,j) = 1 )ï¼šè·¨è¶Šç»“æž„ / sky / æ·±åº¦è¾¹ç¼˜
* ( E(i,j) = 0 )ï¼šåŒä¸€è¿žç»­è¡¨é¢

ðŸ‘‰ å«ä¹‰ï¼š

* æ·±åº¦æ¢¯åº¦å˜åŒ–å¤§ â†’ å¼¹æ€§å¼±
* è¾¹ç¼˜å¤„ â†’ å¼¹æ€§è¿‘ä¼¼ä¸º 0ï¼ˆåŠ›ä¸ä¼ å¯¼ï¼‰

---

## 3.4 èƒ½é‡å‡½æ•°å®šä¹‰ï¼ˆå…¨å‡¸ï¼‰

### 1ï¸âƒ£ Anchorï¼ˆé’‰å­ï¼‰é¡¹ï¼ˆlog ç©ºé—´ï¼‰

å¯¹æ¯ä¸ªå‚è€ƒç‚¹ ( k )ï¼ŒæŠ•å½±åˆ°åƒç´  ( i_k )ï¼š

[
\mathcal{L}_{\text{anchor}}
===========================

\sum_k
\alpha_k
\left(
z_0(i_k) + \Delta(i_k)
----------------------

\log D^{\text{ref}}_k
\right)^2
]

* ( \alpha_k )ï¼šé«˜æƒé‡ï¼ˆæˆ– hard constraintï¼‰

---

### 2ï¸âƒ£ å„å‘å¼‚æ€§å¼¹æ€§é¡¹ï¼ˆæ ¸å¿ƒï¼‰

[
\mathcal{L}_{\text{elastic}}
============================

\sum_{(i,j)}
w_{ij}
\left(
\Delta(i) - \Delta(j)
\right)^2
]

* è¿™æ˜¯ä¸€ä¸ª **åŠ æƒ Laplacian æ­£åˆ™**
* è‡ªåŠ¨å½¢æˆ piecewise-rigid åŒºåŸŸ

---

### 3ï¸âƒ£ DAP æ¢¯åº¦ä¿æŒé¡¹ï¼ˆå½¢çŠ¶å…ˆéªŒï¼‰

åœ¨ **log-depth ç©ºé—´**ï¼š

[
\mathcal{L}_{\text{grad}}
=========================

\sum_i
|
\nabla (z_0(i) + \Delta(i))
---------------------------

\nabla z_0(i)
|_2^2
]

ç­‰ä»·äºŽï¼š

[
\sum_i |\nabla \Delta(i)|^2
]

ï¼ˆä½†ä¿ç•™æ˜¾å¼å½¢å¼æ›´åˆ©äºŽç†è§£ï¼‰

---

## 3.5 æ€»èƒ½é‡

[
\mathcal{L}
===========

\mathcal{L}*{\text{anchor}}
+
\lambda*{\text{elastic}}
\mathcal{L}*{\text{elastic}}
+
\lambda*{\text{grad}}
\mathcal{L}_{\text{grad}}
]

ðŸ‘‰ **ä¸¥æ ¼äºŒæ¬¡åž‹ï¼Œå‡¸ä¼˜åŒ–ï¼Œä¸€æ¬¡è§£å®Œã€‚**

---

## 3.6 çº¿æ€§ç³»ç»Ÿå½¢å¼ï¼ˆå·¥ç¨‹å®žçŽ°ï¼‰

ä»¤ï¼š

* ( \boldsymbol{\Delta} \in \mathbb{R}^N )
* ( \mathbf{L} )ï¼šåŠ æƒå›¾ Laplacian
* ( \mathbf{A} )ï¼šanchor å¯¹è§’çŸ©é˜µ
* ( \mathbf{b} )ï¼šanchor åç½®é¡¹

è§£ï¼š

[
(\mathbf{L}

* \lambda_{\text{grad}} \mathbf{L}_0
* \mathbf{A})
  \boldsymbol{\Delta}
  =
  \mathbf{b}
  ]

- ç¨€ç–å¯¹ç§°æ­£å®š
- å¯ç”¨ CG / Cholesky

---

## 3.7 è¾“å‡ºæ·±åº¦ï¼ˆå›žåˆ°çº¿æ€§ç©ºé—´ï¼‰

[
D(i)
====

\exp\big(z_0(i) + \Delta(i)\big)
]

---

## 4ï¸âƒ£ å…³é”®å®žçŽ°æ³¨æ„äº‹é¡¹ï¼ˆéžå¸¸é‡è¦ï¼‰

### âœ” å¿…é¡»åœ¨ log-depth ç©ºé—´åšçš„ï¼š

* æ·±åº¦æ¢¯åº¦è®¡ç®—
* anchor è¯¯å·®
* ä½ç§»å˜é‡å®šä¹‰

### âŒ ä¸è¦åœ¨ log ç©ºé—´åšçš„ï¼š

* sky / edge mask
* åƒç´ é‚»æŽ¥æ‹“æ‰‘

---

## 5ï¸âƒ£ æ–¹æ³•çš„â€œé’‰å­ç»·æ©¡çš®ç­‹â€è§£é‡Šï¼ˆä¸€å¥è¯ç‰ˆï¼‰

> **å‚è€ƒç‚¹æŠŠ log-depth é’‰æ­»ï¼Œ
> å„å‘å¼‚æ€§ Laplacian è®©ä¿®æ­£åªåœ¨ç»“æž„å†…éƒ¨åƒæ©¡çš®ç­‹ä¸€æ ·ä¼ æ’­ï¼Œ
> åœ¨è¾¹ç¼˜ä¸Žå¤©ç©ºå¤„è‡ªç„¶æ–­è£‚ã€‚**

---

